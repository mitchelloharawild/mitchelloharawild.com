{
  "hash": "bab0480f6b3e1dd1b938201d1185b530",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Introducing feasts\ndescription: 'Feature extraction and statistics for time series'\nauthor: Mitchell O'Hara-Wild\ndate: '2019-08-30'\ncategories:\n  - release\n  - time series\n  - tidyverse\ntags:\n  - cran\n  - package\n  - time series\nimage: 'feasts-opengraph.png'\nimage-alt: 'fable: tidy time series forecasting'\n---\n\n\n\n\n\n`<img src=\"feasts.png\" class=\"hex\"/>`{=html}\n\nFeast your eyes on the latest CRAN release to the collection of [tidy time series R packages](http://tidyverts.org/). The [feasts package](http://feasts.tidyverts.org/) is feature-packed with functions for understanding the behaviour of time series through visualisation, decomposition and feature extraction. The package name *feasts* is an acronym summarising its key features: *Feature Extraction And Statistics for Time Series*. Much like [Earo Wang](https://earo.me/)'s [tsibble](https://tsibble.tidyverts.org/) package, the feasts package is designed to work with multiple series observed at any time interval. \n\nIf you've used graphics from [Rob Hyndman](https://robjhyndman.com/)'s [forecast](http://pkg.robjhyndman.com/forecast/) package or features from [tsfeatures](https://pkg.robjhyndman.com/tsfeatures/), this package allows these features to be used seamlessly with tsibble and the tidyverse.\n\nWith the package now available on CRAN, it is now easier than ever to install:\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"feasts\")\n```\n:::\n\n\nTo see what is on feasts' menu, we'll start by loading a few packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tsibble)\nlibrary(feasts)\n```\n:::\n\n\nIn particular, we'll be exploring the total quarterly Australian domestic overnight trips for a variety of locations and purposes around Australia.\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 24,320 x 5 [1Q]\n# Key:       Region, State, Purpose [304]\n   Quarter Region   State           Purpose  Trips\n     <qtr> <chr>    <chr>           <chr>    <dbl>\n 1 1998 Q1 Adelaide South Australia Business  135.\n 2 1998 Q2 Adelaide South Australia Business  110.\n 3 1998 Q3 Adelaide South Australia Business  166.\n 4 1998 Q4 Adelaide South Australia Business  127.\n 5 1999 Q1 Adelaide South Australia Business  137.\n 6 1999 Q2 Adelaide South Australia Business  200.\n 7 1999 Q3 Adelaide South Australia Business  169.\n 8 1999 Q4 Adelaide South Australia Business  134.\n 9 2000 Q1 Adelaide South Australia Business  154.\n10 2000 Q2 Adelaide South Australia Business  169.\n# i 24,310 more rows\n```\n\n\n:::\n:::\n\n\nThere's plenty more datasets to explore in the [tsibbledata](/blog/tsibbledata/) package. \n\nNot sure what a tsibble is? Learn about tidy time series data in [*Reintroducing tsibble: data tools to melt the clock*](https://blog.earo.me/2018/12/20/reintro-tsibble/).\n\n## Graphics\n\nA time series can be plotted in many ways, each of which providing a different perspective into the features and structural patterns of the time series.\n\nThe most common graphic is a time series plot, which simply shows the data (y-axis) against time (x-axis).\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  group_by(Purpose) %>% \n  summarise(Trips = sum(Trips)) %>% \n  autoplot(Trips)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-1.png){width=816}\n:::\n:::\n\n\nThis allows us to see the big picture, and especially evident is that Holiday travel is the most common domestic tourism purpose. We can also see a substantial increase in trips after 2010. Holiday and business trips show the most seasonality, but it is unclear which quarter has the most trips.\n\nFor a closer look at seasonality we can see seasonal plots (`gg_season()`) and seasonal subseries plots (`gg_subseries()`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  group_by(Purpose) %>% \n  summarise(Trips = sum(Trips)) %>% \n  gg_season(Trips)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/season-1.png){width=816}\n:::\n:::\n\n\nA seasonal plot wraps the time axis by each seasonal period (in this case years), to more clearly display the seasonality in the data. It is clear from the Holiday facet that most trips are made in Q1, possibly to make the most of Australia's hot summer days. It also seems that Q1 (summer) and Q4 (spring) are popular times to visit friends and family, with Q2 (autumn) and Q3 (winter) being a common time for business trips.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  group_by(Purpose) %>% \n  summarise(Trips = sum(Trips)) %>% \n  gg_subseries(Trips)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/subseries-1.png){width=816}\n:::\n:::\n\n\nThe subseries plot is especially useful for identifying changes in seasonal patterns over time. It produces a set of data subseries for the times within each seasonal period. The above shows separate plots consisting of the data from the same quarter, and the blue line indicates the average. From this plot we can see that Q4 business trips have stopped growing, whilst Q1-Q3 continue to trend upward.\n\nThe feasts package can also do many more time series graphics, including:\n\n* Lag plots `gg_lag()`\n* Autocorrelation plots (`autoplot()` of `ACF()`, `PACF()`, or `CCF()`)\n* Ensemble plots for time series (`gg_tsdisplay()`)\n* Ensemble plots for time series residuals (`gg_tsresiduals()`)\n* Plots of characteristic ARMA root (`gg_arma()`)\n\nTo see more of these plots in action, check out Rob Hyndman's blog post on [*Time series graphics with feasts*](https://robjhyndman.com/hyndsight/feasts/).\n\nAlso try out Earo Wang's incredible calendar plots (`facet_calendar()` ðŸ¤¯) from her [sugrrants](https://pkg.earo.me/sugrrants/) package!\n\n## Decompositions\n\nThe first release of feasts contains two decompositions which tidy up existing functions from the stats package.\n\n\n::: {.cell asis='true'}\n::: {.cell-output-display}\n\n\n|Method                           |stats         |feasts                      |\n|:--------------------------------|:-------------|:---------------------------|\n|Classical seasonal decomposition |`decompose()` |`classical_decomposition()` |\n|Loess seasonal decomposition     |`stl()`       |`STL()`                     |\n\n\n:::\n:::\n\n\nTime series decompositions allow you to isolate structural components such as trend and seasonality from the data. The decomposition functions in feasts use a model-like formula interface, allowing you to control many aspects of the decomposition (using `season(window = 5)` allows the seasonality to change fairy quickly for quarterly data).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  group_by(Purpose) %>% \n  summarise(Trips = sum(Trips)) %>% \n  model(STL(Trips ~ season(window = 5))) %>% \n  components()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A dable: 320 x 8 [1Q]\n# Key:     Purpose, .model [4]\n# :        Trips = trend + season_year + remainder\n   Purpose  .model       Quarter Trips trend season_year remainder season_adjust\n   <chr>    <chr>          <qtr> <dbl> <dbl>       <dbl>     <dbl>         <dbl>\n 1 Business STL(Trips ~~ 1998 Q1 3599. 3814.     -425.       210.          4024.\n 2 Business STL(Trips ~~ 1998 Q2 3724. 3854.      185.      -315.          3539.\n 3 Business STL(Trips ~~ 1998 Q3 4356. 3895.      296.       165.          4060.\n 4 Business STL(Trips ~~ 1998 Q4 3796. 3936.      -42.9      -97.7         3838.\n 5 Business STL(Trips ~~ 1999 Q1 3335. 3991.     -431.      -225.          3766.\n 6 Business STL(Trips ~~ 1999 Q2 4714. 3986.      174.       555.          4540.\n 7 Business STL(Trips ~~ 1999 Q3 4190. 3986.      285.       -81.4         3905.\n 8 Business STL(Trips ~~ 1999 Q4 3701. 3970.        1.45    -271.          3700.\n 9 Business STL(Trips ~~ 2000 Q1 3562. 3943.     -464.        83.8         4026.\n10 Business STL(Trips ~~ 2000 Q2 4018. 3991.      162.      -135.          3856.\n# i 310 more rows\n```\n\n\n:::\n:::\n\n\nThe decomposed table (`dable`) explains how the `Trips` variable has been split into three new series via `Trips = trend + season_year + remainder`, which has been done for all four travel purposes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  group_by(Purpose) %>% \n  summarise(Trips = sum(Trips)) %>% \n  model(STL(Trips ~ season(window = 5))) %>% \n  components() %>% \n  autoplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/dcmp-plot-1.png){width=816}\n:::\n:::\n\n\nThe dable can also be plotted to show how each of the decomposed components vary between series and time. A dable also behaves very similarly to a tsibble, allowing you to visualise the seasonality without distractions of trend and remainder terms.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  group_by(Purpose) %>% \n  summarise(Trips = sum(Trips)) %>% \n  model(STL(Trips ~ season(window = 5))) %>%\n  components() %>% \n  gg_season(season_year)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/dcmp-season-1.png){width=816}\n:::\n:::\n\n\n## Features\n\nA big *feature* of feasts is the ability to extract a set of features (single value summary of data characteristics) from the time series.\n\nFeatures are particularly useful for visualising large collections of time series. Plotting multiple time series using the above methods do not scale very well beyond 10 similar series, and the original `tourism` dataset contains 304 (and even more if you consider aggregates)!\n\nThe STL decomposition above can be used to compute features about the [strength of the its trend and seasonality components](https://otexts.com/fpp3/seasonal-strength.html), allowing us to see an overview of the entire dataset's patterns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  features(Trips, feature_set(tags = \"stl\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 304 x 12\n   Region State Purpose trend_strength seasonal_strength_year seasonal_peak_year\n   <chr>  <chr> <chr>            <dbl>                  <dbl>              <dbl>\n 1 Adela~ Sout~ Busine~          0.464                  0.407                  3\n 2 Adela~ Sout~ Holiday          0.554                  0.619                  1\n 3 Adela~ Sout~ Other            0.746                  0.202                  2\n 4 Adela~ Sout~ Visiti~          0.435                  0.452                  1\n 5 Adela~ Sout~ Busine~          0.464                  0.179                  3\n 6 Adela~ Sout~ Holiday          0.528                  0.296                  2\n 7 Adela~ Sout~ Other            0.593                  0.404                  2\n 8 Adela~ Sout~ Visiti~          0.488                  0.254                  0\n 9 Alice~ Nort~ Busine~          0.534                  0.251                  0\n10 Alice~ Nort~ Holiday          0.381                  0.832                  3\n# i 294 more rows\n# i 6 more variables: seasonal_trough_year <dbl>, spikiness <dbl>,\n#   linearity <dbl>, curvature <dbl>, stl_e_acf1 <dbl>, stl_e_acf10 <dbl>\n```\n\n\n:::\n:::\n\n\nThe features from an STL decomposition also describe other behaviours such as how linear, curved, and spiky the data is. This dataset of features can be used with ggplot2 (and other packages) to produce stunning overviews of many time series.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  features(Trips, feature_set(tags = \"stl\")) %>% \n  ggplot(aes(x = trend_strength, y = seasonal_strength_year, colour = Purpose)) + \n  geom_point() + \n  stat_density_2d(aes(fill = Purpose, alpha = ..level..), bins = 5, geom = \"polygon\") + \n  facet_wrap(vars(Purpose), nrow = 1) +\n  coord_equal() + \n  xlim(c(0,1)) + ylim(c(0,1)) + \n  labs(x = \"Trend strength\", y = \"Seasonal strength\") + \n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/features-plot-1.png){width=816}\n:::\n:::\n\n\nHere, it is clear that holiday travel is the most seasonal purpose of tourism in Australia, however this is only the case for some regions. The strength of trend in these series varies similarly across travel purpose.\n\nThe first release includes a total of 42 feature metrics, which can be computed together using `feature_set(pkgs = \"feasts\")`. A list of all currently available features can be found in links from the `?feature_set` help file.\n\n\n# Read more about feasts\n\n* The [pkgdown website](http://feasts.tidyverts.org/)\n* [*Time series graphics*](https://otexts.com/fpp3/graphics.html) from [*Forecasting: Principles and Practices (3ed.)*](https://otexts.com/fpp3/)\n* The vignettes: [*Introduction to feasts*](http://feasts.tidyverts.org/articles/feasts.html)\n* The [GitHub repository](https://github.com/tidyverts/feasts/)",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}